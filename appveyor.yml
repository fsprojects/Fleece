image: Visual Studio 2017
init:
  - git config --global core.autocrlf input
build_script:
  - msbuild /m /t:restore Fleece.sln
  - msbuild /m  Fleece.sln
  - dotnet pack Fleece /p:VersionSuffix=alpha-%APPVEYOR_BUILD_NUMBER%
  - dotnet pack Fleece.FSharpData /p:VersionSuffix=alpha-%APPVEYOR_BUILD_NUMBER%
  - dotnet pack Fleece.NewtonsoftJson /p:VersionSuffix=alpha-%APPVEYOR_BUILD_NUMBER%
test_script:
  - dotnet run --project .\Tests\Tests.fsproj --framework net461
  - dotnet run --project .\Tests.FSharpData\Tests.FSharpData.fsproj --framework net461
  - dotnet run --project .\Tests.NewtonsoftJson\Tests.NewtonsoftJson.fsproj --framework net461

artifacts:
  # pushing all *.nupkg files in build directory recursively
  - path: '**\*.nupkg'

nuget:
  account_feed: true
  project_feed: true
  disable_publish_on_pr: false
